<dom-module id="image-magnifier">
    <template>
        <style>
            :host {
                display: block;
                position: absolute;
                pointer-events: none;
            }

            #outline {
                right: 0;
                top: 0;

                position: absolute;
                z-index: 1000;
                width: 90px;
                height: 90px;
                pointer-events: none;
            }
            
            /* Magnifier Arrow */
            #outline:before {
                content: "";
                width: 30px;
                height: 30px;
                top: 7px;
                right: 7px;
                position: absolute;
                background: white;
            }

            #container {
                width: 80px;
                height: 80px;
                border: 5px solid white;
                border-radius: 100px;
                overflow: hidden;
                background: #111;
                position: absolute;
            }

            #container img {
                position: relative;
                image-rendering: pixelated;
            }

            #pixel-outline {
                position: absolute;
                border: 1px solid white;

                /*
                    -1px on each side for
                    the outline
                */
                width: 18px;
                height: 18px;

                top: 30px;
                left: 30px;

                z-index: 1000;
                opacity: 0.5;
            }

            zoomable-image {
                position: absolute;
                image-rendering: pixelated;
            }
        </style>

        <div id="outline">
            <div id="container">
                <div id="pixel-outline"></div>
                <zoomable-image
                    src="[[src]]"
                    scale="[[scale]]"
                    x-offset="[[_toOffset(xPixel)]]"
                    y-offset="[[_toOffset(yPixel)]]"

                    style="[[_getOffsetStyle(scale)]]"
                ></zoomable-image>
            </div>
        </div>
    </template>
</dom-module>

<script type="text/javascript">
    // image-magnifier Element
    // A magnifying glass that zooms in to an image to give
    // pixel detail

    // The magnifier points to the top-right of the container. Set
    // the postion of the <image-magnifier> element to the point
    // you want it to point to

    // TODO: allow for dynamic setting of the size of the magnifying
    // glass. The style limits it to 80x80 at the moment
    // TODO: Zoom is not very flexible, either. The styles basically dictate
    // that we expect a 20x zoom
    // TODO: Make the positioning smart so will flip sides if it starts
    // to run off the screen
    class ImageMagnifier extends Polymer.Element {
        static get is() { return 'image-magnifier' }

        static get properties() {
            return {
                // The zoom factor on the image
                scale: {
                    type: Number,
                    value: 1
                },

                // The image source to display
                src: {
                    type: String,
                    value: ''
                },

                // The x pixel to zoom in on
                xPixel: {
                    type: Number,
                    value: 0
                },

                // The y pixel to zoom in on
                yPixel: {
                    type: Number,
                    value: 0
                }
            }
        }

        // Utilities
        _toOffset(px) {
            return -px + 2
        }

        _getOffsetStyle(s) {
            const offset = -s / 2
            return `top:${offset}px; left:${offset}px;`
        }
    }

    customElements.define(ImageMagnifier.is, ImageMagnifier)
</script>