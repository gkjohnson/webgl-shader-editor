<dom-module id="zoomable-image">
    <template>
        <style>
            :host {
                display: block;
                position: relative;
            }
            
            #proxy-image {
                visibility: hidden;
            }

            #zoom-container {
                width: 100%;
                height: 100%;
                position: absolute;
                overflow: hidden;
                top: 0;
                left: 0;
            }

            #zoom-image {
                position: absolute;
            }


        </style>

        <!--
            Image used to scale the container
            appropriately
        -->
        <img
            id="proxy-image"
            src="[[src]]"
        />

        <div id="zoom-container">        
            <img
                id="zoom-image"
                src="[[src]]"
                style="[[_getStyle(scale, xOffset, yOffset)]]"
            />
        </div>
    </template>
</dom-module>

<script type="text/javascript">
    class ZoomableImage extends Polymer.Element {
        static get is() { return 'zoomable-image' }

        static get properties() {
            return {
                scale: {
                    type: Number,
                    value: 1,
                    notify: true,
                    observer: '_scaleObserver'
                },

                maxScale: {
                    type: Number,
                    value: 10
                },

                src: {
                    type: String,
                    value: ''
                },

                xOffset: {
                    type: Number,
                    value: 0,
                    notify: true
                },

                yOffset: {
                    type: Number,
                    value: 0,
                    notify: true
                }
            }
        }

        // Lifecycle
        ready() {
            super.ready()

            this.addEventListener('wheel', e => this.scale -= e.deltaY * 1e-2)
        }

        // Utilities
        _getStyle(s, x, y) {
            x *= s
            y *= s
            s *= 100
            return `width:${s}%; top:${x}px; left:${y}px;`
        }

        // Observers
        _scaleObserver(s) {
            s = Math.max(1, Math.min(this.maxScale, s))
            if (this.scale !== s) this.scale = s
        }
    }

    customElements.define(ZoomableImage.is, ZoomableImage)
</script>