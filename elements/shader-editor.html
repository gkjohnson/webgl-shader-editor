<dom-module id="shader-editor">
    <template>
        <style type="text/css">
            #container {
                display: flex;
                height: 100%;
            }

            shader-preview {
                flex: 1;
                max-width: 400px;
            }

            #editors {
                height: 100%;
                display: flex;
                flex-direction: column;
                flex: 2;
            }

            ace-editor {
                flex: 1;
            }

            h5 {
                padding: 5px;
                margin: 0;
                color: white;
                background: #272822;
                font-size: 12px;
            }
        </style>
        <div id="container">
            <div id="editors">
                <h5>Vertex Shader</h5>
                <ace-editor
                    value="{{ vertexShader }}"
                    type="glsl"
                ></ace-editor>
                
                <h5>Fragment Shader</h5>
                <ace-editor
                    value="{{ fragmentShader }}"
                    type="glsl"
                ></ace-editor>
            </div>
            <shader-preview
                vertex-shader="[[ vertexShader ]]"
                vertex-errors="{{ vertexErrors }}"
                fragment-shader="[[ fragmentShader ]]"
                fragment-errors="{{ fragmentErrors }}"
            ></shader-preview>
        </div>
    </template>
</dom-module>
<script type="text/javascript">
    const vs = `// Lighting
struct DirLight {
    vec3 color;
    vec3 direction;
};

uniform DirLight directionalLights[NUM_DIR_LIGHTS];
uniform vec3 ambientLightColor;

varying vec3 lighting;

void main() 
{
    vec3 worldNorm = (modelViewMatrix * vec4(normal, 0)).xyz;
    
    lighting = ambientLightColor;
    for(int i = 0; i < NUM_DIR_LIGHTS; i ++) {
        DirLight dl = directionalLights[i];
        lighting += clamp(dot(worldNorm, dl.direction), 0.0, 1.0) * dl.color;
    } 

    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`

    const fs = `varying vec3 lighting;

void main() {
    vec3 rgb = vec3(1, 1, 1);

    gl_FragColor = vec4(rgb * lighting, 1);
}`

    class ShaderEditor extends Polymer.Element {
        static get is() { return 'shader-editor' }

        static get properties() {
            return {
                vertexShader: {
                    type: String,
                    value: vs,
                    notify: true
                },

                fragmentShader: {
                    type: String,
                    value: fs,
                    notify: true,
                },

                vertexErrors: {
                    type: Array,
                    value: null,
                    notify: true
                },

                fragmentErrors: {
                    type: Array,
                    value: null,
                    notify: true
                }
            }
        }

        _attachDom(d) { this.appendChild(d) }
    }
 
    customElements.define(ShaderEditor.is, ShaderEditor)
</script>