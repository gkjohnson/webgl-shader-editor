
<style> ace-editor { display: block; } </style>

<script type="text/javascript">
    class AceEditor extends Polymer.Element {
        static get is() { return 'ace-editor' }

        static get properties() {
            return {
                value: {
                    type: String,
                    value: '',
                    notify: true,
                    observer: '_valueObserver'
                },

                annotations: {
                    type: Array,
                    value: () => [],
                    observer: '_annotationsObserver'
                },

                _editor: {
                    type: Object,
                    value: null                    
                }
            }
        }

        /* Lifecycle */
        ready() {
            this.value = this.innerText || this.value
            super.ready()
            this._editor = ace.edit(this)
            this._editor.setTheme("ace/theme/monokai")
            this._editor.getSession().setMode("ace/mode/glsl")
            this._editor.setShowPrintMargin(false)

            this._editor.setValue(this.value)
            this._editor.session.setAnnotations(this.annotations)
            this._editor.selection.clearSelection()

            this._editor.on('change', (e, ed) => this.value = ed.getValue())
        }

        /* Observers */
        _valueObserver(val) {
            if (!this._editor || this._editor.getValue() == val) return
            this._editor.setValue(val)
            this._editor.selection.clearSelection()
        }

        _annotationsObserver(ann) {
            if (this._editor) this._editor.session.setAnnotations(ann)
        }

        /* Overrides */
        _attachDom(d) { this.appendChild(d) }
    }

    customElements.define(AceEditor.is, AceEditor)
</script>