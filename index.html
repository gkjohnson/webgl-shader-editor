<!DOCTYPE html>
<html>
<head>
    <title></title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100" rel="stylesheet">

    <!-- Scripts -->
    <script src="./node_modules/@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="./node_modules/ace-builds/src-min/ace.js"></script>
    <script src="./node_modules/three/build/three.js"></script>
    <script src="./node_modules/three/examples/js/controls/OrbitControls.js"></script>
    <script src="./scripts/DebugShaders.js"></script>

    <!-- Elements -->
    <link rel="import" href="./node_modules/@polymer/polymer/polymer-element.html" />
    <link rel="import" href="./node_modules/@polymer/polymer/lib/elements/dom-if.html"/>
    <link rel="import" href="./node_modules/@polymer/polymer/lib/elements/dom-repeat.html"/>

    <link rel="import" href="./elements/ace-editor.html" />
    <link rel="import" href="./elements/zoomable-image.html" />
    <link rel="import" href="./elements/image-magnifier.html" />
    <link rel="import" href="./elements/shader-editor.html" />
    <link rel="import" href="./elements/shader-preview.html" />

    <style type="text/css">
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;

            font-weight: 100;
            font-family: Roboto, sans-serif;
        }

        ::-webkit-scrollbar
        {
            width: 5px;
            position: absolute;
        }

        ::-webkit-scrollbar-thumb
        {
            border-radius: 5px;
            background-color: rgba(255,255,255,0.2);
        }

    </style>
</head>
<body>
    <shader-editor></shader-editor>
    <script type="text/javascript">
    
        const se = document.querySelector('shader-editor')
            const vs = `// Lighting
struct DirLight {
    vec3 color;
    vec3 direction;
};

uniform DirLight directionalLights[NUM_DIR_LIGHTS];
uniform vec3 ambientLightColor;

varying vec3 lighting;

void main() 
{
    vec3 worldNorm = (modelViewMatrix * vec4(normal, 0)).xyz;
    
    lighting = ambientLightColor;
    for(int i = 0; i < NUM_DIR_LIGHTS; i ++) {
        DirLight dl = directionalLights[i];
        lighting += clamp(dot(worldNorm, dl.direction), 0.0, 1.0) * dl.color;
    } 

    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`

    const fs = `varying vec3 lighting;

void main() {
    vec3 rgb = vec3(1, 1, 1);

    gl_FragColor = vec4(rgb * lighting, 1);
}`
        window.onunload = () => {
            localStorage.setItem('vertexShader', se.vertexShader)
            localStorage.setItem('fragmentShader', se.fragmentShader)
        }

        se.vertexShader = localStorage.getItem('vertexShader') || vs
        se.fragmentShader = localStorage.getItem('fragmentShader') || fs
    </script>
</body>
</html>